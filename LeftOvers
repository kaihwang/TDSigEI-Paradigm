% left overs

%% practice blocks
%if 1 ==0
keepchecking3=1;
while keepchecking3==1 % don't understand this while loop's purpose.
    
    prac_trial_picker=randperm(size(prac_names,2)); %randomize the sequence of practice stimuli order
    
    for i = 1:prac_trial_num % loop through number of practice trials
        
        %pic_bl=prac_images;
        %    pres_bl_AE2(window,curr_tr_len,1,pic_bl,black,white,pic_on_time,fix_on_time,centerx,centery,data_str,'1','1');
        
        
        Screen(window,'FillRect',black);
        Screen(window,'PutImage',squeeze(prac_images(prac_trial_picker(i),:,:,:)),imageRect); % display practice image
        Screen(window, 'Flip');
        DaqDOut(HID,0,1);  %Turn on
        
        %routines to log key stroke and RT timing
        keepchecking = 1;
        RT=-1;
        resp=-1;
        trial_start_time=GetSecs;
%         while (keepchecking == 1)
%             [keyIsDown,secs,keyCode] = KbCheck; % In while-loop, rapidly and continuously check if the Z or / key is being pressed.
%             if find(keyCode==1)==29  % If key is being pressed...
%                 keepchecking = 0; % ... end while-loop.
%                 RT=GetSecs-trial_start_time;
%             end
%             if find(keyCode==1)==56  % If key is being pressed...
%                 keepchecking = 0; % ... end while-loop.
%                 RT=GetSecs-trial_start_time;
%             end
%             if ((GetSecs - trial_start_time) > stim_on_time)
%                 keepchecking=0; %when reach the maximum stimulus presentation time, exit loop
%             end
%         end
        ButtonResponse=-1;
        while (keepchecking == 1)
           if Gamepad('GetButton',1,5)==1  % If key is being pressed...
                    ButtonResponse=5;
                    keepchecking = 0; % ... end while-loop.
                    RT=GetSecs-trial_start_time;
           end
           if Gamepad('GetButton',1,8)==1  % If key is being pressed...
                    ButtonResponse=8
                    keepchecking = 0; % ... end while-loop.
                    RT=GetSecs-trial_start_time;
           end
           if ((GetSecs - trial_start_time) > stim_on_time)
                keepchecking=0; %when reach the maximum stimulus presentation time, exit loop
            end
        end
        
        
        %determine key response mapping
        if ButtonResponse ==5
            resp=1;
        elseif ButtonResponse ==8
            resp=0;
        else
            resp = -1; %in the case of no keystroke or wrong key?
        end
        
%         if find(keyCode==1)==56
%             resp=1;
%         elseif find(keyCode==1)==29
%             resp=0;
%         else
%             resp = -1; %in the case of no keystroke or wrong key?
%         end
        
        %only move on to the next phase when reach the maximum stimulus presentation time
        while ((GetSecs - trial_start_time) < stim_on_time)
        end
        DaqDOut(HID,0,0);  %Turn off
        
        %put up a blank delay screen between stimuli presentation and
        %feedback
        Screen(window,'FillRect',black);
        centertext(window,' ',20,centery-10,centerx,centery,white);
        Screen(window, 'Flip');
        starttime2=GetSecs;
        
        while (GetSecs - starttime2 < delay_time)
        end
        
        
        %     Screen(window,'FillRect',black);
        %     centertext(window,'+',20,centery-10,centerx,centery,white);
        %     Screen(window, 'Flip');
        
        %determine feedback
        prac_feedback=round(rand(1));
        Screen(window,'FillRect',black);
        if prac_feedback==resp; %correct response
            centertext(window,'Correct!',60,centery-30,centerx,centery,orange);
            Screen(window, 'Flip');
        elseif prac_feedback~=resp && resp~=-1; %incorrect response
            centertext(window,'Incorrect!',60,centery-30,centerx,centery,grey);
            Screen(window, 'Flip');
        elseif resp == -1; %no correct key stroke detected
            centertext(window,'Please respond faster!',60,centery-30,centerx,centery,white);
            Screen(window, 'Flip');
        end
        %DaqDOut(HID,0,1);  %Turn on
        %feedback on screen till ITI
        starttime2=GetSecs;
        while (GetSecs - starttime2 < feedback_time)
        end
        %DaqDOut(HID,0,0);  %Turn off
        %display a randomized ITI
        Screen(window,'FillRect',black);
        centertext(window,'+',20,centery-10,centerx,centery,white);
        Screen(window, 'Flip');
        starttime2=GetSecs;
        
        while (GetSecs - starttime2 < ITIs(randi(7)))
        end
        
    end
    
    
    %prepare to start the task, exit the practice phase
    Screen(window,'FillRect',black);
    SCREEN('TextFont', window ,'Arial');
    centertext(window,'The practice block is now complete.  Please press the <enter> key',20,centery-80,centerx,centery,white);
    centertext(window,'if you are ready for the first block or press the <spacebar> if',20,centery-40,centerx,centery,white);
    centertext(window,'you would like more practice.',20,centery,centerx,centery,white);
    centertext(window,'Remember to press the orange button for sunny and press the green button for rainy.',20,centery+40,centerx,centery,white);
    %centertext(window,'and press the "spacebar" if any body picture is repeated.',20,centery+80,centerx,centery,white);
    Screen(window, 'Flip');
    keepchecking =1;
    
    %A keystroke will exit the practice phase
    while (keepchecking == 1)
        [keyIsDown,secs,keyCode] = KbCheck; % In while-loop, rapidly and continuously check if the Z or / key is being pressed.
        if find(keyCode==1)==40  % If key is being pressed...
            keepchecking = 0; % ... end while-loop.
            keepchecking3=0;
        end
        if find(keyCode==1)==44  % If key is being pressed...
            keepchecking = 0; % ... end while-loop.
            keepchecking3=1;
        end
    end
    
end
